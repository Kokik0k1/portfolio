<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>プロジェクト管理システム</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>プロジェクト管理システム</h1>
            <div class="view-toggle">
                <button class="toggle-btn active" onclick="showView('table')">テーブル表示</button>
                <button class="toggle-btn" onclick="showView('graph')">関係図表示</button>
                <button class="toggle-btn" onclick="showView('timeline')">タイムライン表示</button>
            </div>
        </div>
        
        <div class="content">
            <div class="controls">
                <!-- データインポート/エクスポート機能 -->
                <div class="export-dropdown">
                    <button class="export-btn" onclick="toggleExportMenu()">データ出力 ▼</button>
                    <div class="export-menu" id="export-menu">
                        <div class="export-option" onclick="exportData('json')">
                            <div class="format-name">JSON形式</div>
                            <div class="format-desc">構造化データとして出力</div>
                        </div>
                        <div class="export-option" onclick="exportData('yaml')">
                            <div class="format-name">YAML形式</div>
                            <div class="format-desc">設定ファイルに適した形式</div>
                        </div>
                        <div class="export-option" onclick="exportData('tsv')">
                            <div class="format-name">TSV形式</div>
                            <div class="format-desc">スプレッドシートに貼り付け可能</div>
                        </div>
                    </div>
                </div>
                
                <button class="add-btn" onclick="openImportModal()">データインポート</button>
            </div>
            
            <!-- テーブル表示 -->
            <div id="table-view" class="view active">
                <div class="table-container">
                    <table id="project-table">
                        <thead>
                            <tr>
                                <th>種類</th>
                                <th>ID</th>
                                <th>名前</th>
                                <th>ステータス</th>
                                <th>開始日</th>
                                <th>終了日/期日</th>
                                <th>依存関係</th>
                                <th>説明</th>
                            </tr>
                        </thead>
                        <tbody id="table-body">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- グラフ表示 -->
            <div id="graph-view" class="view">
                <div class="controls" style="margin-bottom: 10px;">
                    <button class="btn btn-secondary" onclick="resetZoom()">ズームリセット</button>
                    <button class="btn btn-secondary" onclick="autoLayout()">自動レイアウト</button>
                    <span style="margin-left: 20px; font-size: 12px; color: #666;">
                        マウスホイール: ズーム | ドラッグ: パン | ノードドラッグ: 移動
                    </span>
                </div>
                <div class="graph-container" id="graph-container">
                    <svg class="graph-svg" id="graph-svg">
                        <defs>
                            <marker id="arrowhead" markerWidth="10" markerHeight="7" 
                                    refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#90a4ae" />
                            </marker>
                        </defs>
                        <g id="graph-group"></g>
                    </svg>
                    
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #9c27b0; border-color: #7b1fa2;"></div>
                            <span>マイルストーン</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #ffcdd2; border-color: #c62828;"></div>
                            <span>未開始タスク</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #ffe0b2; border-color: #ef6c00;"></div>
                            <span>進行中タスク</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #c8e6c9; border-color: #2e7d32;"></div>
                            <span>完了タスク</span>
                        </div>
                    </div>
                    
                    <!-- ツールチップ -->
                    <div id="tooltip" class="tooltip"></div>
                </div>
            </div>
            
            <!-- タイムライン表示 -->
            <div id="timeline-view" class="view">
                <div class="timeline-controls">
                    <span style="font-weight: 600; margin-right: 10px;">表示期間:</span>
                    <button class="timeline-zoom-btn active" onclick="setTimelineZoom('month')">月単位</button>
                    <button class="timeline-zoom-btn" onclick="setTimelineZoom('week')">週単位</button>
                    <button class="timeline-zoom-btn" onclick="setTimelineZoom('day')">日単位</button>
                    <span style="margin-left: 20px; font-size: 12px; color: #666;">
                        赤線: 今日 | バーホバー: 詳細表示
                    </span>
                </div>
                
                <div class="timeline-container" id="timeline-container">
                    <div class="timeline-header">
                        <div class="timeline-sidebar" id="timeline-sidebar" style="width: 200px !important; min-width: 200px !important; max-width: 200px !important; flex-shrink: 0 !important;">項目</div>
                        <div class="timeline-dates" id="timeline-dates"></div>
                    </div>
                    
                    <div class="timeline-content">
                        <div class="timeline-items" id="timeline-items" style="width: 200px !important; min-width: 200px !important; max-width: 200px !important; flex-shrink: 0 !important;"></div>
                        <div class="timeline-chart" id="timeline-chart">
                            <div class="timeline-grid" id="timeline-grid"></div>
                            <div class="timeline-today-line" id="timeline-today-line"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- データインポートモーダル -->
    <div id="import-modal" class="modal">
        <div class="modal-content large">
            <span class="close" onclick="closeImportModal()">&times;</span>
            <h2>データインポート</h2>
            
            <div class="form-group">
                <label>インポート形式を選択:</label>
                <div style="display: flex; gap: 15px; margin: 10px 0;">
                    <label style="display: flex; align-items: center; gap: 5px;">
                        <input type="radio" name="import-format" value="tsv" checked onchange="updateImportFormat()">
                        TSV（推奨・スプレッドシートから）
                    </label>
                    <label style="display: flex; align-items: center; gap: 5px;">
                        <input type="radio" name="import-format" value="json" onchange="updateImportFormat()">
                        JSON
                    </label>
                </div>
            </div>
            
            <div id="tsv-import" class="import-section">
                <div class="form-group">
                    <label>TSVデータを貼り付け:</label>
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                        スプレッドシートでデータを作成し、全体を選択してコピー＆ペーストしてください<br>
                        <strong>必須列:</strong> 種類, ID, 名前, ステータス, 開始日, 終了日/期日, 依存関係, 説明
                    </div>
                    <textarea id="tsv-input" placeholder="種類	ID	名前	ステータス	開始日	終了日/期日	依存関係	説明
マイルストーン	M1	プロジェクト開始	マイルストーン		2024-01-15		プロジェクトキックオフ
タスク	T1	要件分析	完了	2024-01-16	2024-02-15	M1	システム要件の分析" style="height: 200px; font-family: monospace; font-size: 12px;"></textarea>
                </div>
            </div>
            
            <div id="json-import" class="import-section" style="display: none;">
                <div class="form-group">
                    <label>JSONデータを貼り付け:</label>
                    <textarea id="json-input" placeholder='{"milestones": [...], "tasks": [...]}' style="height: 200px; font-family: monospace; font-size: 12px;"></textarea>
                </div>
            </div>
            
            <div class="form-group">
                <label style="display: flex; align-items: center; gap: 5px;">
                    <input type="checkbox" id="replace-data" checked>
                    既存データを置き換える（チェックを外すと追加モード）
                </label>
            </div>
            
            <div class="form-actions">
                <button type="button" class="copy-btn" onclick="importData()">インポート実行</button>
                <button type="button" class="btn btn-secondary" onclick="closeImportModal()">キャンセル</button>
            </div>
        </div>
    </div>
    
    <!-- データ出力モーダル -->
    <div id="export-modal" class="modal">
        <div class="modal-content large">
            <span class="close" onclick="closeExportModal()">&times;</span>
            <h2 id="export-modal-title">データ出力</h2>
            
            <div class="export-data" id="export-data-content"></div>
            
            <div class="form-actions">
                <button type="button" class="copy-btn" id="copy-btn" onclick="copyToClipboard()">クリップボードにコピー</button>
                <button type="button" class="btn btn-secondary" onclick="downloadFile()">ファイルダウンロード</button>
                <button type="button" class="btn btn-secondary" onclick="closeExportModal()">閉じる</button>
            </div>
        </div>
    </div>
    
    <script src="script.js"></script>
</body>
</html>